from fastapi import APIRouter
from repos.supabase_repo import upsert_character, upsert_scenario, delete_character_by_id, delete_scenario_by_id

router = APIRouter(prefix="/dev", tags=["dev"])

@router.post("/seed")
def seed_minimum_data():
    # 기존 기본 캐릭터 제거
    delete_character_by_id("char_a")
    delete_character_by_id("char_b")
    delete_scenario_by_id("scn_folk_01")
    delete_scenario_by_id("scn_folk_02")

    # 캐릭터 2종
    upsert_character(
        id="momo",
        name="모모",
        persona_prompt=(
            "당신은 '사고의 확장'을 돕는 가이드입니다. "
            "시나리오 속에서 아이가 당연하게 넘길 수 있는 부분에 '왜?'를 던지세요. "
            "목표: 아이가 '물질적 이익'보다 '형제애'라는 보이지 않는 가치를 스스로 발견하게 하는 것. "
            "가이드 원칙: 1. 상황의 이상한 점 지적하기 ('내 볏단이 줄어드는데 왜 형은 춤을 춰?') "
            "2. 가설 던지기 ('만약 아무도 모르게 볏단을 다 줘버리면 형은 가난해질까, 행복해질까?') "
            "3. 아이의 논리를 존중하며 다음 질문으로 연결하기."
        ),
        description='사고를 확장하는 질문 가이드. "왜?"로 생각의 문을 열어줘요.',
        image_url="images/momo.png",
        is_active=True,
    )
    upsert_character(
        id="bobo",
        name="보보",
        persona_prompt=(
            "당신은 '정서적 공감'을 돕는 가이드입니다. "
            "아이의 대답에서 '느낌'을 포착하고 따뜻하게 피드백하세요. "
            "목표: 아이가 '배려'를 했을 때 느껴지는 내면의 뿌듯함을 인지하게 하는 것. "
            "가이드 원칙: 1. 감정 단어 거울링 ('형을 생각하는 마음이 참 따뜻하구나') "
            "2. 아이의 경험과 연결 ('준이도 친구에게 양보했을 때 이런 기분이었어?') "
            "3. 가치 긍정하기 ('누군가를 위하는 마음은 세상에서 가장 반짝이는 보물이야.')."
        ),
        description="감정을 읽고 공감해주는 따뜻한 가이드. 마음을 말로 정리해줘요.",
        image_url="images/bobo.png",
        is_active=True,
    )

    # 시나리오 2종
    upsert_scenario(
        id="scn_folk_01",
        name="전래동화 1 (의좋은 형제 - 볏단 이야기)",
        story=(
            "옛날 아주 먼 옛날, 금슬 좋은 형제가 살았어요. "
            "가을이 되어 풍년이 들자 형과 아우는 수확한 볏단을 똑같이 나누었죠. "
            "그런데 밤이 되자 형은 '아우는 아직 젊으니 더 많이 필요할 텐데'라 생각하며 "
            "몰래 자신의 볏단을 아우의 논에 옮겨주었어요. "
            "같은 시각, 아우도 '형님은 자식들이 많으니 더 많이 필요하실 텐데'라며 "
            "몰래 자신의 볏단을 형의 논에 옮겨주었답니다. "
            "이튿날 아침, 줄어들지 않은 볏단을 보고 이상하게 여긴 형제가 밤중에 마주치게 되고, "
            "서로를 배려하는 마음에 감동하며 얼싸안았다는 이야기예요."
        ),
        goal="아이 스스로 형제애/배려 같은 보이지 않는 가치를 발견하도록 돕는다.",
        outline=(
            "형제가 서로를 위해 몰래 볏단을 옮기며 마음을 확인하는 이야기. "
            "누가 더 손해를 보느냐가 아니라, 왜 그렇게 했는지가 핵심이다. "
            "상대방을 생각하는 따뜻한 마음이 무엇인지 함께 탐색한다."
        ),
        scenario_prompt=(
            "진행 규칙: 1) 먼저 시나리오 개요를 3~5문장으로 쉽게 설명한다. "
            "2) 다음에 목표를 1문장으로 알려준다. "
            "3) 이후 캐릭터 역할에 따라 질문/공감 방식으로 아이가 스스로 답을 찾게 돕는다. "
            "4) 한 번에 질문은 1개만 한다."
        ),
        first_message="안녕! 오늘은 재미있는 전래동화 '의좋은 형제' 이야기를 같이 생각해볼까?",
        is_active=True,
    )
    upsert_scenario(
        id="scn_folk_02",
        name="전래동화 2 (흥부와 놀부)",
        story=(
            "옛날 옛날 아주 먼 옛날, 흥부와 놀부 형제가 살았어요. "
            "놀부는 욕심이 많아 부자가 되었지만, 착한 흥부는 가난하게 살았죠. "
            "어느 날 흥부가 다친 제비 다리를 고쳐주자, 제비는 흥부에게 박씨를 물어다 주었어요. "
            "그 박에서는 금은보화가 쏟아져 나와 흥부는 부자가 되었답니다. "
            "이 소식을 들은 놀부는 욕심이 나서 멀쩡한 제비 다리를 부러뜨려 박씨를 얻었어요. "
            "하지만 놀부의 박에서는 도깨비와 똥물이 쏟아져 나와 놀부는 벌을 받았다는 이야기예요."
        ),
        goal="선의/나눔의 의미와 그로 인해 발생하는 긍정적인 결과를 감정과 판단 모두로 이해하도록 돕는다.",
        outline=(
            "어려운 상황에서도 나누는 선택(흥부)과 욕심을 부리는 선택(놀부)이 "
            "어떤 마음과 어떤 결과를 만들었는지 살펴보는 이야기. "
            "착한 마음이 왜 중요한지 탐색한다."
        ),
        scenario_prompt=(
            "진행 규칙: 1) 개요 -> 2) 목표 -> 3) 캐릭터 방식 진행. "
            "4) 아이 답을 먼저 확인하고, 다음 질문/공감으로 연결한다. "
            "5) 한 번에 질문은 1개만 한다."
        ),
        first_message="안녕! 오늘은 '흥부와 놀부' 이야기를 같이 들여다보자.",
        is_active=True,
    )

    return {"ok": True}
